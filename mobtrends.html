<!DOCTYPE html>
<html>
<head>
  <!-- Meta pour la vue sur les appareils mobiles -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Chargement des bibliothèques -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.3.0/dist/aframe-master.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <!-- Script pour le composant personnalisé "play-pause" -->
  <script>

    // Composant Play-Pause pour les vidéos

    AFRAME.registerComponent("play-pause", {
      init: function() {

        this.el.addEventListener("click", (e)=>{

          console.log("click");

          // Récupère l'id de l'élément sur lequel on a cliqué
          const id = $(this.el).attr("id");

          // on récupère sa vidéo associé
          const video = document.getElementById('video-' + id);

          // on récupère son bouton de lecture associé
          const videoControls = document.getElementById('image-'+ id);

          console.log("ID de l'élément:", id);
          // Vérifier si la vidéo est en pause
          if (video.paused) {
            // Démarrer la lecture de la vidéo
            video.play();
            videoControls.setAttribute("src" , "#pause")
          } else {
            // Mettre la vidéo en pause
            video.pause();
            videoControls.setAttribute("src" , "#play")
          }
        })


      }
    })
  </script>
</head>
<body>

  <!-- Scène A-Frame -->
  <a-scene cursor="rayOrigin: mouse" mindar-image="imageTargetSrc: images/mobTrend.mind; filterMinCF:0.0005; filterBeta: 0.0005" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
 
    <!-- Ressources pré-chargées -->
    <a-assets>
      <video id="video-maVideo1" muted autoplay loop src="videos/octo-video.mp4"></video>
      <video id="video-maVideo2" muted autoplay loop src="videos/octo-video2.mp4"></video>
      <video id="video-maVideo3" muted autoplay loop src="videos/octo-video3.mp4"></video>
      <img id="play" src="images/play-button.png" >
      <img id="pause" src="images/pause.png" >
    </a-assets>

    <!-- Caméra -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Entité vidéo avec cible MindAR -->
    <a-entity class="video" id="maVideo1" mindar-image-target="targetIndex: 0" raycaster="objects: #maVideo1, #image" play-pause>
      <a-video  id="maVideo1" src="#video-maVideo1" position="0 0 0" height="0.5" width="0.5" rotation="0 0 0" >
          <a-image id="image-maVideo1" src="#play" position="0 -0.35 0" height="0.15" width="0.15" rotation="1 0 0" ></a-image>
      </a-video>
    </a-entity>

    <a-entity class="video" id="maVideo2" mindar-image-target="targetIndex: 1" raycaster="objects: #maVideo2, #image" play-pause>
        <a-video id="maVideo2" src="#video-maVideo2" position="0 0 0" height="0.5" width="0.5" rotation="0 0 0" >
            <a-image id="image-maVideo2" src="#play" position="0 -0.35 0" height="0.15" width="0.15" rotation="1 0 0" ></a-image>
        </a-video>
      </a-entity>

      <a-entity class="video" id="maVideo3" mindar-image-target="targetIndex: 2" raycaster="objects: #maVideo3, #image" play-pause>
        <a-video id="maVideo3" src="#video-maVideo3" position="0 0 0" height="0.5" width="0.5" rotation="0 0 0" >
            <a-image id="image-maVideo3" src="#play" position="0 -0.35 0" height="0.15" width="0.15" rotation="1 0 0" ></a-image>
        </a-video>
      </a-entity>
    
  </a-scene>

  <!-- Bouton de rechargement -->
  <div id="reload" style="display:none;width:25px;background-image: url('images/reload.png');background-size:cover;background-color:red;height:25px;position:absolute;right:20px;bottom:20px"> </div>

  <!-- Script pour détecter les événements de cible trouvée ou perdue -->
  <script>

        // Apparition du bouton de reload à l'apparition d'un marqueur

        let currentVideoId = null;
        let videoActuel = null;

        // Sélectionner tous les éléments avec la classe .video
        const videos = document.querySelectorAll('.video');

        // Itérer sur chaque élément sélectionné
        videos.forEach(video => {
                // Ajouter un écouteur d'événements pour "targetFound"
                video.addEventListener("targetFound", event => {
                    // Mettre à jour la variable avec l'ID de la vidéo
                    currentVideoId = video.id;
                    videoActuel = document.getElementById('video-' + currentVideoId);
                    console.log("target found for video with ID:", currentVideoId);
                    // Afficher le bouton "reload"
                    document.getElementById("reload").style.display = "block";
                });

                // Ajouter un écouteur d'événements pour "targetLost"
                video.addEventListener("targetLost", event => {
                    console.log("target lost");
                    // Masquer le bouton "reload"
                    document.getElementById("reload").style.display = "none";
                    videoActuel.pause();
                });
        });

        // Redemarrage video 

        // Sélectionner l'élément avec l'ID "reload"
        const reloadButton = document.getElementById("reload");

        // Ajouter un écouteur d'événements pour l'événement "click"
        reloadButton.addEventListener("click", event => {
        // Action à effectuer lors du clic sur le bouton "reload"
            console.log(currentVideoId);
            videoActuel.load();
            videoActuel.play();
        // Insérez ici le code pour recharger ou rafraîchir les éléments nécessaires
        });

  </script>

</body>
</html>
